#!/bin/bash

# This script generates a kustomization.yaml that references vendored CRDs in this repository.

set -o errexit
set -o nounset
set -o pipefail

REPO_ROOT=$(dirname ${BASH_SOURCE})/..

generate_kustomization_file() {
  local file_path=$1

  echo "INFO: Generating ${file_path} referencing local vendored CRDs"
  echo "# Generated by scripts/generate-crd-kustomize.sh. DO NOT EDIT.
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - gateway-operator

patches:
  - path: patches/zz_generated_conversion_webhook.yaml

configurations:
  - kustomizeconfig.yaml" > "${file_path}"
}

generate_kustomization_file \
  "${REPO_ROOT}/config/crd/kustomization.yaml"
