---
apiVersion: v1
kind: Namespace
metadata:
  name: ($kong_namespace)
---
apiVersion: gateway-operator.konghq.com/v1beta1
kind: DataPlane
metadata:
  name: ($dataplane_name)
  namespace: ($kong_namespace)
spec:
  deployment:
    podTemplateSpec:
      spec:
        containers:
        - name: proxy
          image: kong:3.9
---
apiVersion: gateway-operator.konghq.com/v1beta1
kind: ControlPlane
metadata:
  name: ($controlplane_name)
  namespace: ($kong_namespace)
spec:
  dataplane: ($dataplane_name)
  gatewayClass: ($gateway_class_name)
  deployment:
    podTemplateSpec:
      spec:
        containers:
        - name: controller
          image: kong/kubernetes-ingress-controller:3.5.0
          env:
          - name: CONTROLLER_FEATURE_GATES
            value: "RewriteURIs=true,GatewayAlpha=true"
          readinessProbe:
            initialDelaySeconds: 1
            periodSeconds: 3
          resources:
            requests:
              memory: "64Mi"
              cpu: "250m"
            limits:
              memory: "1024Mi"
              cpu: "1000m"
